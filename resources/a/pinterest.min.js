$(function(){var a=$("#container"),t=$("#j_loadMore"),s=$(".j_loading"),r=$("#j_mmType").find("a"),q=1,w=0,j=0,v=145,y=10,e=v+y,l=[],k=[],g="",c=null,x="onorientationchange" in window?"orientationchange":"resize";function o(){var i=320;if(document.body&&document.body.clientWidth){i=document.body.clientWidth}else{if(document.documentElement&&document.documentElement.clientWidth){i=document.documentElement.clientWidth}}return i}function p(){var A,z=0,B=0,C=l[0],D=l[0];for(A=1;A<l.length;A++){if(l[A]<C){z=A;C=l[A]}else{if(l[A]>D){B=A;D=l[A]}}}return{low:z,high:B}}function b(){j=Math.floor(o()/e);if(j>5){j=5}a.css("width",j*e-y)}b();for(var u=0;u<j;u++){l[u]=0;k[u]=e*u}var m=location.href;if(typeof api_url!="undefined"){m=api_url}function n(){var z=function(A){if(A==="open"){t.css("display","none");s.css("display","block")}else{if(A==="close"){t.css("display","block");s.css("display","none")}}};z("open");var i=encodeURI(m+"tag="+g+"&counts="+q);$.ajax({url:i,type:"get",data:{},dataType:"json",cache:false,timeout:3000000,success:function(E){if(E.status){var F=E.data;if(Object.prototype.toString.call(F)!=="[object Array]"||F.length==0){return false}var B=function(K){if(K.length==0){return false}var J=$("<img />"),L=parseInt(K.height*(v/K.width)),H=p().low;J.css({width:v,height:L,left:k[H],top:l[H]});J.attr("src",K.src);l[H]+=L+10;var I=$('<a href="'+K.link+'" ></a>');I.append(J);a.append(I);var H=p().high;a.css("height",l[H])};var D=function(H,J){var I=new Image();I.src=J.img_url;I.onload=function(){if(J.counts==q){var K={src:this.src,width:this.width,height:this.height,link:J.link,ch:J.ch,sid:J.sid,aid:J.aid};B(K);w++}else{c==null}}};var A=F.length;for(var C=0;C<A;C++){D(C,F[C])}var G=new Date().getTime();c=setInterval(function(){var H=new Date().getTime(),I=parseInt((H-G)/1000);if(w>=A||I==30){w=0;clearInterval(c);z("close")}},300)}else{z("close");alert(E.message)}},error:function(){z("close");alert("您的网络不给力,请点击重试!")}})}$(window).on(x,function(){d()});function d(){var z=j;b();if(z==j){return}l=[];k=[];for(var A=0;A<j;A++){l[A]=0;k[A]=e*A}a.find("img").each(function(){var i=p().low;$(this).css({left:k[i],top:l[i]});l[i]+=$(this).height()+10;var i=p().high;a.css("height",l[i])})}function h(A){var A=$(A);g=A.text();A.addClass("active").siblings().removeClass("active");q++;a.css("height","60px");a.find("img").remove();l=[];k=[];for(var z=0;z<j;z++){l[z]=0;k[z]=e*z}n()}function f(){window.onpageshow=function(){setTimeout(function(){d()},100)}}setTimeout(function(){n();f();t&&t.on("click",n);r&&r.on("click",function(){h(this)})},100)});